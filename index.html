<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Encrypted page</title>
</head>
<body>
  <div>
    <input id="pw" type="password" placeholder="Enter password">
    <button id="btn" onclick="attemptUnlock()">Unlock</button>
  </div>
  <div id="status"></div>
  <div id="content" style="display:none"></div>

<script>
const tokenB64 = "q8CWvhWvqQCXIOL8OMkqd4QQISfvoh0Er6aIEKC92t3y4AR_OESTvnsVp23jt_friMI9TaO8TMaN4iJuDY0uq2EoNlZSXpEkFA3I_s4ZaQhQRivZQ_wgkJISlrN0XRaeCOhaz7o9_vdBk56tTLWM-y46GuP7VDRv2Ha1_Zu_ZiSpN6ttJXOIQPrx9ybfgCD4lBsL2n8lCZ6j3WqgRv92UhE7t1LQKszqBOZZTC5YApVitJb5uqv9yNVN3j6cYt4ZDJNRTPx_TyhsTkdT3WKAcps3fSZfTcBM3iXPiLtS7XtIkRRHxaSn9zDD169DHks2yLs2CR3e5mYwRqSX36kw0jqBslKO0NEJ6S2Y9LB15k7XZrqrpNWA_SCibdXOmbmVHGmfLJs-HPeK55BzjIVymUI5Nuh-H-hYODosHplPfDUFt5_SwDZ2ke2PAkUpzTHCHfUocKiVScW9kmlfx6WgYq9TTdF43Nsyo8qD3Jx9YgFcMjqS52p30LAVxWDo0VAofBEDmj6z1GRJLw5rhrFsmG3vfR7Uo3iC7zcY72XEHOSEHPuTFbedAq-cIAPLB3kan52ijJVrQReCxQ4PkkJgDtRW_35FVOSYZ3D6j7dAaxIhvFq1-Ax3wK0IWQqZnYeoWSndHOPemBg9fnI8hvsrO4siQMN-NxDwBS5Tj-ytqC1J5Qiy-KW8S76n5UXxTS7Hk8JtElZ1-TfCI16VeOmKajKY_MbXp62OD-mu0AlNx5uOZvSbkKIIipyDtsvihx0ACkQwrtmI6zNh-euuAU3xrPbkPnvY64u86IaOZKY2o_v0hYz9wq5Q88l5GA4yojqbQWMP8Xx4MZQIjghpn6WKTStUVvaYWyXTUYrDtvU6DuLysGHHw9LCDHFepzD_SZijzB_TBPGtJLcSUXvMR75CNYjiNjZsmiG4TCMBSOPXp5jP7LJtGKuiYAHu8K00Le47cx85-HvDf8URVtghIHS7plBvDdBAAzT-L5896UnaPo8LFUbqqJAmKBndZ063yoCdNz-pTmfWfWL4aH82iTmb-i1eTW0n2nEMrvEwwBe8SQNfujrZwJ-Ct3zIokKzlmRxsDHx6CgAewof9FlHR3u22buvjfRHBhdDzKpmEDsEuli4JAt43oza-wqpogC5eNXd_XUgdIX99-Kfljl4JweC7AR08HSSEaRVTc1OSijl60G2GWO0SG9gcfXu9ToFQ-G7YHF9dyY6RBXK2bi19C64QcqGe7PlWUI9qluf-V2Dg7cxDfX2sLMDfQqEBs3y2fdnwG0bkn5f0Fi_nlQ3hnh7qolwjIlV2jDNn1cA5C7SQs2U11nc9_2CWJxOXeBil5VeTfwPvvOtWvTvYq6eKG3KMowfKCyAKuJNAeEIifZ-z4D2LnMFoo26qupXft6x0mY0VDMlzNp2SuE3sW75u8hZhmWSTB2n-FKtbie3DEskcMR5Ymy9CEO1jfI8kQXnK3s25j8rIh9kPgvIaUKailnQcM5sAI5HBKvZcKGBRliaqdJW-b-yVrzC2o-NrAf_iOZ-oZf8T4se4APp8AUK83S_HTL9ZP1ukQ2o8tnfiKwERmiux3ml773Nt6Usm2JKuv6KIVkunTSFHEE-9KPDxynMhSS8J16FlTES_LuX-p8CtKwJo3HVB3YZZxLqW1U9ZVJtEZRLZxavvPzR5Ga1aYBmk5O7J9BlQMp1tBMyI6pWdSZqOxyq9hbBgOsT3I23xZCGPUZme9SlrvyUJA27Zb6JZis9p144LQctqfIIFGbiFdsZQG5fGpF28KMR1qrEsx_Sxfhci7BvfVm-lCf2zAuTHTKgZy839u4_4FTJR7XVfyr9KAD0xcEAQ7RxjKLgIPMJnNoTMz_ZII-DC2KsMgkPsGGnzuguoWFIrRz5zshIYCf2HkTTSN39FEk1v4oH3ZcpbKCjhnaq0ESc-TlJgZoxN5yu_m76OU-qLt7M9hKShzCJF9TWKVZqmcjGXd8agGqLZvJYCyc1yO_yw3Sq422aA2zWo5S6jAJvBnaBTVHoJrM8ofNIbnG3nxfyi8X6BeIwXBtvnhVbl7WUipKU5xNq-kxc84NeaXxMBtzYcdArOxWKu2-GpAMJzNZ0TrSKbHdF61UoUROC_g1GRqkWHz1SxouEQxKfp0TWyb9BzHrue8xMd6JbIQkVh1JzD2YCEXF73MV4NaW-Ao-Ulb8QvYewFkgZoTHR44y-5q3HgsCkrPK01HQ5oWWv5dCfWYLriOSO4-VtDZwmP0XwHFel3djN1qvicpO1o530ngTDHWAPlPmA5--pLJDuoZjUjNrWHwrG8E34I4X9Jho6r4CfTzi9yGVfQ7O2PPFH9dy197riyuAW-yrxc46Ofv0cjr_yybWSCgHduIAHQw6kIU-7ONmOVM5XwafYycJ5wybjiuG23fMXbKm7d072lTQIC5MvOOrHSSFAyqpPJXK1qNYZh7hygkNkNktTXH1qaa7qTJxl8Sqn1yUIav1oebhUMwWwT1gcxRSusGYC-sqYvqqLpgLLfPPd_HpBLO8Q84dbEGGF8jjxLKw-5DJG0QQvYsviZOi6cq6lR8xWGIFNCGq_-gpqZuCr_ynB2YmhpDR2ZKF3t1HNk4OZICOHTUa5Cj6BZrvp3FnOMwMMYv1a5fC8H0-fR7jY5WAOumuPHYaQM0XzrB74QB-M0J6nRsYk_vZ6FQNqpXNk1fi6LR6tWNiLcqWdwODMCp9XfXOoZ2ZXbBhI5K1tkTrS43u4RBELZATbNqFx4zcf9yJTQzpKDzAETCKU27mssqS_0EeqaxHvQYGuzQo_R-NDc9l5lmpxxrLVZdQk6peCmAmtG_0eLIECPvpBZPaoLqT5g92feeLzEs9QeCNpGVava7RlTGN1AfUhW0FT2dfLyb2irgAHu-hHPXTZWNp4B2a9unkkjyldzO7ffmpFATxu9Vkk2wvHk1T4hm297noStQvBiVTKI2G5TWqhTBGQnwLMd9gPijtJRFZm5y3MEXflf8D1XrQLH5udye7B1Ypewx8Dho1MsMeEKbqbKd3_ob6MS37K3HFKf1yT93Q8YsDiyK8k13XiCvKLaiAmwZq5eGWLEVwVHHs8HZEKBLde1yL3Vo65uy1W5khFardydrYQ4qJY1bowA-rYc8Cns2asU0uMHockAOr9rCdO6GrSEws7SvblQqKdeSaqp6By90jB_cMOyP-B42k2GN-73KHMyu-0SvAluNnBftxyrtB7Ig9y5ddfIXw2ryCVkx45260HHcNf792vrgW5nFIRApSaqi_etCTJIK8QTJcjG6gUzq_jrKR9_Vbw_TprBTPlI8u2YVn95PZZnrAX6nB3RCaHmpod_5xrjVDsnNIIG_9EClEnjuuygvwcVZFJlbjhdxPRJ0A9YM6SzxNLZujB5adRzDbZFGqPTPiQQX3n5wfnqAvoNTTsP0e7G883UWx1PazxCb8_L8VFN27c7BymtMf44hUHQPxmZOxKMsnbVy0e52qHtLkgbaXuXiy7rFxWicxAvnsWYcEvq9U0iB4TOU15D2CYp45hE8RXcBe5VBkpm6iQ3aZC2CrZqskPucvBI5e12YLKD05_7EAHjMf2JcdGX4NjcGhmHeVBjRtSwXZ3-Fk4kDCuNqlkyUrVdgra6IMWn6ov8IWwRc5DMgkQXTJBybbA8jFReau-mWrip98vTbm8HO0dwnl3XW-pnrlWrBoqhtz_XNH-IGh61_WZkFmZtdYKTeCUAeU0me0qayop8qDmpGq2QTe6lcAIJ_Tccw3L01iTt75FXjdYr1MOL7mhvjlBrQQJGgq-zv-2GCUWz3Qkqyf7Uba2nPbYwMiHBch6G_oWEeFRNKYl91rz_xqHCp6hh_bx6lgmgYu2KH4nTcxiMGtYL11LtZ3uT2EYCG17_6yk_7SZlvZ5hwazl9UTwzrUG8pmOga2kKX6ec7BgCk1jWhBrTisB6hAC0LV52CgAbmRIgbVMMcUwNURfN_bJw6yWEp-IGQbeOf1G9feTW4EeCY4QS9K1yBFqJNo1dj5riidbjQyAKSudqukcQ6X8PBtRFqeP69RD9CrGzJ9BzV746bcEUV7T_Q76o-8tXFjtYkeQvBDpsNy9s-UniAZxGFu84i5U-qcLJJFGuuOz8PhhCe9dHwgfnBHtRrrfmcx0fmF8fd1NoJq2i8iorrdMvPHhs6C2uudSytJ4iFnMuIFPXKwVXBvZjSi9KotrcWnrZUAQ9K2zRp6jwg9Iq6BcLt5b0NLkzLCZ-6ZhwwXXbwB8gt1REEMcpWelCjm0XIJqtdml_DKbCSL3JAhpVSe_2fOzIjudWj4oahCFZ36l4jMQd0S5vXgck4xRdT4AT9G-j30g_j6kFajUtJxqhLLsdkLGocIPNp1QNPdjvhysF-2If35Rnz5Wc4aAmQqU4IRmXgmkZPbfPQmMAeSGbx9ljNtFSqcMRAhuBIbC9hpifnSAFLmKNJX1RXG6mpBKt5I7cnxnUKJKrNM9toM9S-NR_xaTPT0BnJD__MCANrTtfZs-urz0Pha6HPKaqScApnNiqYe1LQfmcW0DqrbhBnx4SV1M4VT16J4cXsLz3F4lj49J128EvUsGe_zqMfNK3bvhYT-Lf4BsomNVCT5dPkr0sWy8Mp7rtgEr7GJ5wOudUxNOw6DNSJflFtAB0J0zwOFOrf0xjEmVX3C4vIgHXPrIr_BDVIq1XuSzowd1ezPa2zMdlzBpq4wLJcbmolZ1MyWgUimVMwax5wXh9ntE3aOyxRsaiIhGHVmkPd7c5aIR0ejvq6VxL1rpFh0GefX89elh9VriyHY72P53BcGyPNpFEF8u9W4CJFnLOQ5TIACKEA10_QhDg7zAIWB46uQW2_can0ydQTAjxdRYN3klOSq816ee85zmvONt9CaIjn64yQN69WVDHBxv4xHqGzIchnyLlRxSclW7RWTWhKtvOfL9FnRw06oA8q_B_kGfIMVLImbWJ-ds0K44nTWWM5fM6-9FJ8a1Mb43jpzR1mCcJymK7yOWS5nGnVqclKNaEE8S4wheJVxO24grzILw5GkBPkyKtYq0q4nFLRMkK3L6ToSf8Q8kVXart-TuZ6WY17PV1I0vHe6VjPSCBdkTpg6g6NiknIOZfGwlpiwf9djvPzwomgSJnTsmxtT_078hF95nWc2KBtMr3HHj7W1PBVeSSLpeb2sLWXpin29EPqHT6eP2OPxQcKugUBX9yLU_uGW6aIrDkahNkxsVu0-eESXAWxfr9ma9LxHH7ZqZKIk6_sZrh9qnt0aV5DRnIQ0EO-UAKlmf1-h7JXWgL6CM0EvV1XYebVkBWSUjU4E6doe0IGQxXzsPYjBmF7cq86gRbRWJ5T9YPdGnuCDtw9AkFewwMpAwpe4xjWkCXuDZhlhY5lqjAPnvYoqZYelr3de5xwUKav7J2kUXZENlPuXB4d_U4-z9REp3xLvXOgEFu9xggK5r_rwRaCkxyaFleYTsg7JOzu4I8zRWa64jdWilu8tHrXk28eNXTtDAenhW2I7HnUalCQwCTfhsLZVSXmQws-pRv5qxg=="; // embedded encrypted payload (iv + ciphertext)
function b64UrlToUint8Array(s) {
  // base64 urlsafe -> normal base64
  s = s.replace(/-/g, '+').replace(/_/g, '/');
  // add padding
  while (s.length % 4) s += '=';
  const bin = atob(s);
  const arr = new Uint8Array(bin.length);
  for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);
  return arr;
}

async function deriveKey(password) {
  // SHA-256(password) -> raw 32 bytes used as AES-GCM key
  const pwUtf8 = new TextEncoder().encode(password);
  const hash = await crypto.subtle.digest('SHA-256', pwUtf8);
  // import raw key for AES-GCM
  return crypto.subtle.importKey('raw', hash, {name:'AES-GCM'}, false, ['decrypt']);
}

async function attemptUnlock() {
  const pw = document.getElementById('pw').value || '';
  const status = document.getElementById('status');
  status.textContent = 'Trying...';
  try {
    const key = await deriveKey(pw);
    const token = b64UrlToUint8Array(tokenB64);
    const iv = token.slice(0, 12); // first 12 bytes
    const cipher = token.slice(12); // rest = ciphertext || tag
    const plainBuf = await crypto.subtle.decrypt(
      { name: 'AES-GCM', iv: iv }, key, cipher
    );
    const decoded = new TextDecoder().decode(plainBuf);

    // Parse decrypted HTML
    const parser = new DOMParser();
    const doc = parser.parseFromString(decoded, 'text/html');

    // Optionally set a <base> so relative URLs in decrypted HTML resolve correctly.
    // By default we set it to the current page location (encrypted_page.html).
    // If your content.html and encrypted_page.html live in different directories,
    // set base.href accordingly (e.g. "data/").
    let baseEl = doc.querySelector('base');
    if (!baseEl) {
      baseEl = doc.createElement('base');
      // Set base to current page. Change this if your content assets are located elsewhere.
      baseEl.href = location.href;
      doc.head.insertBefore(baseEl, doc.head.firstChild);
    }

    // Inject CSS <link> tags from decrypted HTML into real document head
    const links = doc.querySelectorAll('link[rel="stylesheet"]');
    links.forEach(l => {
      try {
        const newLink = document.createElement('link');
        newLink.rel = 'stylesheet';
        // resolve href relative to base
        newLink.href = new URL(l.getAttribute('href'), baseEl.href).href;
        document.head.appendChild(newLink);
      } catch(e) { console.warn('CSS link error', e); }
    });

    // Insert the body content into our content container
    const contentEl = document.getElementById('content');
    // Clear previous content
    contentEl.innerHTML = '';
    // Move nodes from parsed doc.body into the content container
    Array.from(doc.body.childNodes).forEach(node => {
      // For scripts and links we'll handle them separately below, but append now so relative elements appear.
      contentEl.appendChild(document.importNode(node, true));
    });

    // Execute scripts: find <script> tags inside the inserted content and re-create them so they run.
    const insertedScripts = contentEl.querySelectorAll('script');
    for (const oldScript of insertedScripts) {
      const newScript = document.createElement('script');

      if (oldScript.src) {
        // Resolve src relative to base and add cache buster to avoid caching if needed
        const srcResolved = new URL(oldScript.getAttribute('src'), baseEl.href).href;
        newScript.src = srcResolved + '?v=' + Date.now();
        newScript.async = false; // preserve execution order
        // append to body so it loads and executes
        oldScript.parentNode.replaceChild(newScript, oldScript);
        // wait for it to load before continuing to ensure order
        await new Promise((resolve, reject) => {
          newScript.onload = resolve;
          newScript.onerror = () => { console.warn('Script load failed', newScript.src); resolve(); };
        });
      } else {
        // Inline script: copy text and replace so it executes
        newScript.textContent = oldScript.textContent;
        oldScript.parentNode.replaceChild(newScript, oldScript);
        // inline executes immediately on insertion
      }
    }

    // Now decrypted content inserted and scripts executed.
    contentEl.style.display = 'block';
    document.getElementById('pw')?.remove();
    document.getElementById('btn')?.remove();
    document.getElementById('status')?.remove();

  } catch (e) {
    console.error(e);
    status.textContent = 'Wrong password or decryption failed.';
  }
}
</script>
</body>
</html>
