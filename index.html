<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>no title</title>

<link rel="stylesheet" href="data/styles.css">
</head>
<body>

<div id="playerContainer">

    <!-- SELECT MENU -->
    <select id="bookSelect" style="font-size:16px; padding:5px;">
        <option value="1">Assepoester</option>
        <option value="2">WillemTell</option>
    </select>

    <!-- AUDIO -->
    <audio id="player" controls style="width: 100%; margin-top:10px;"></audio>
</div>

<div id="text"></div>
<div id="translation-box"></div>

<!-- DYNAMIC script placeholder -->
<script id="storyScript"></script>

<script src="data/functions.js"></script>

<script>
// -------------------- Display Text --------------------
function displayText() {
    const container = document.getElementById("text");
    container.innerHTML = "";

    cues.forEach((c, i) => {
        const p = document.createElement("p");
        p.className = "sentence";
        p.id = "s" + i;
        p.textContent = c.text;

        p.addEventListener("click", () => {
            const audio = document.getElementById("player");
            audio.currentTime = c.start;
            audio.play();
            highlightSentence(i);
            scrollToSentence(i);
            showTranslation(i);
        });

        container.appendChild(p);
    });
}

// -------------------- Sync Audio â†’ Text --------------------
document.getElementById("player").addEventListener("timeupdate", function() {
    const t = this.currentTime;

    for (let i = 0; i < cues.length; i++) {
        if (t >= cues[i].start && t <= cues[i].end) {
            highlightSentence(i);
            scrollToSentence(i);
            showTranslation(i);
            break;
        }
    }
});

// -------------------- Highlight --------------------
function highlightSentence(index) {
    document.querySelectorAll(".sentence").forEach(el => el.classList.remove("active"));
    const el = document.getElementById("s" + index);
    if (el) el.classList.add("active");
}

// -------------------- Auto Scroll --------------------
function scrollToSentence(index) {
    const el = document.getElementById("s" + index);
    if (!el) return;

    const rect = el.getBoundingClientRect();
    if (rect.top < 150 || rect.bottom > window.innerHeight) {
        el.scrollIntoView({ behavior: "smooth", block: "center" });
    }
}

// -------------------- Show Translation --------------------
function showTranslation(index) {
    const box = document.getElementById("translation-box");
    const line = cues[index];
    if (!line || !line.text_trans) {
        box.style.display = "none";
        return;
    }
    box.textContent = line.text_trans;
    box.style.display = "block";
}
/* -------------------------
   Load selected story
-------------------------- */
function loadStory(baseName) {
    document.title = baseName;

    // Set audio source
    const audio = document.getElementById("player");
    audio.src = "data/" + baseName;

    // Remove old script
    let oldScript = document.getElementById("storyScript");
    if (oldScript) oldScript.remove();

    // Create a fresh script tag
    let newScript = document.createElement("script");
    newScript.id = "storyScript";
    newScript.src = "data/" + baseName + ".js?v=" + Date.now();

    // Wait for story script to load, then display text
    newScript.onload = () => {
        console.log("Loaded:", newScript.src);
        displayText();
    };

    document.body.appendChild(newScript);
}


// Select menu
document.getElementById("bookSelect").addEventListener("change", function() {
    loadStory(this.value);
	console.log(this.value);
});

// Load default story on first load
loadStory("1");
</script>

</body>
</html>
